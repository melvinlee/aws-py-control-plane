# Welcome to Serverless!
#
# This file is the main config file for your service.
# It's very minimal at this point and uses default values.
# You can always add more config options for more control.
# We've included some commented out config examples here.
# Just uncomment any of them to get that config option.
#
# For full config options, check the docs:
#    docs.serverless.com
#
# Happy Coding!

service: py-control-plane # NOTE: update this with your service name

# You can pin your service to only deploy with a specific Serverless version
# Check out our docs for more details
# frameworkVersion: "=X.X.X"

provider:
  name: aws
  runtime: python3.6

# you can overwrite defaults here
  stage: pro
  region: ap-southeast-1
  iamRoleStatements:
      - Effect: Allow
        Action:
          - ec2:Describe*
          - ec2:Stop*
          - ec2:Start*
        Resource: "*"
      - Effect: Allow
        Action: 
          - autoscaling:UpdateAutoScalingGroup
        Resource: "*"

functions:
  ec2start:
    handler: handler.ec2start
    memorySize: 128
    timeout: 5
    events:
      - schedule: 
          description: 'Run at 9am GMT+8 Mon-Fri'
          rate: cron(0 1 ? * MON-FRI *)
          enabled: true

  ec2stop:
    handler: handler.ec2stop
    memorySize: 128
    timeout: 5
    events:
      - schedule: 
          description: 'Run at 7pm GMT+8 Mon-Fri'
          rate: cron(0 11 ? * MON-FRI *)
          enabled: true

  stop-asg:
  handler: handler.setasginstancesize
  memorySize: 128
  timeout: 5
  events:
    - schedule: 
        description: 'Run at 7pm GMT+8 Mon-Fri'
        rate: cron(0 11 ? * MON-FRI *)
        enabled: true
        input:
          AsgGroupName: sitapp-AutoScaleGrp-XL7APL96YQPQ
          MinSize: 0
          DesiredCapacity: 0

  start-asg:
  handler: handler.setasginstancesize
  memorySize: 128
  timeout: 5
  events:
    - schedule: 
        description: 'Run at 9am GMT+8 Mon-Fri'
        rate: cron(0 1 ? * MON-FRI *)
        enabled: true
        input:
          AsgGroupName: sitapp-AutoScaleGrp-XL7APL96YQPQ
          MinSize: 1
          DesiredCapacity: 1